// ======================================
// Configuration
// ======================================
const ADMIN_PASSWORD = 'admin1234';

// ‚ö†Ô∏è ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Google Apps Script Deploy
const GOOGLE_SHEET_URL = 'YOUR_GOOGLE_APPS_SCRIPT_URL'; // ‡πÉ‡∏™‡πà URL ‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å Deploy ‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà

// Storage for registrations
let registrations = JSON.parse(localStorage.getItem('registrations') || '[]');

// ======================================
// Navigation Functions
// ======================================
function hideAllSections() {
    const sections = ['studentForm', 'adminLogin', 'adminPanel', 'statusCheck'];
    sections.forEach(id => {
        const element = document.getElementById(id);
        if (element) {
            element.style.display = 'none';
        }
    });
}

function showStudentForm() {
    hideAllSections();
    const element = document.getElementById('studentForm');
    if (element) {
        element.style.display = 'block';
    }
}

function showAdminLogin() {
    hideAllSections();
    const element = document.getElementById('adminLogin');
    if (element) {
        element.style.display = 'block';
    }
}

function showStatus() {
    hideAllSections();
    const element = document.getElementById('statusCheck');
    if (element) {
        element.style.display = 'block';
    }
}

// ======================================
// Form Handling
// ======================================
document.addEventListener('DOMContentLoaded', function() {
    // Image Preview
    const photoInput = document.getElementById('photo');
    if (photoInput) {
        photoInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('imagePreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `<img src="${e.target.result}" alt="Preview">`;
                };
                reader.readAsDataURL(file);
                
                // Update label
                const label = document.querySelector('.file-upload-label');
                if (label) {
                    label.textContent = `üì∑ ${file.name}`;
                }
            }
        });
    }

    // Student Registration Form
    const registrationForm = document.getElementById('registrationForm');
    if (registrationForm) {
        registrationForm.addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const data = Object.fromEntries(formData.entries());
            
            // Convert photo to base64
            const photoFile = document.getElementById('photo').files[0];
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    data.photo = e.target.result;
                    submitRegistration(data);
                };
                reader.readAsDataURL(photoFile);
            } else {
                submitRegistration(data);
            }
        });
    }

    // Admin Login Form
    const adminLoginForm = document.getElementById('adminLoginForm');
    if (adminLoginForm) {
        adminLoginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const adminId = document.getElementById('adminId').value;
            
            if (adminId === ADMIN_PASSWORD) {
                hideAllSections();
                const adminPanel = document.getElementById('adminPanel');
                if (adminPanel) {
                    adminPanel.style.display = 'block';
                }
                loadRegistrations();
                showNotification('‚úÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
            } else {
                showNotification('‚ùå ‡∏£‡∏´‡∏±‡∏™‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
            }
            
            document.getElementById('adminLoginForm').reset();
        });
    }

    // Status Check Form
    const statusForm = document.getElementById('statusForm');
    if (statusForm) {
        statusForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const studentId = document.getElementById('checkStudentId').value;
            const studentRegistrations = registrations.filter(r => r.studentId === studentId);
            
            const statusResult = document.getElementById('statusResult');
            if (!statusResult) return;
            
            if (studentRegistrations.length === 0) {
                statusResult.innerHTML = '<div style="text-align: center; color: #666; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 10px;">‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Ç‡∏≠‡∏á‡∏£‡∏´‡∏±‡∏™: ' + studentId + '</div>';
                return;
            }

            let resultHTML = '<h3 style="margin-top: 20px; color: #333;">üìã ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</h3>';
            studentRegistrations.forEach(registration => {
                resultHTML += `
                    <div class="registration-item" style="margin-top: 15px;">
                        <div class="registration-details">
                            <div><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${registration.firstName} ${registration.lastName}</div>
                            <div><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</strong> ${registration.studentNumber}</div>
                            <div><strong>‡∏´‡πâ‡∏≠‡∏á:</strong> ${registration.classroom}</div>
                            <div><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</strong> ${registration.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                            <div><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span class="status-badge status-${registration.status}">${registration.statusText}</span></div>
                            <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${new Date(registration.timestamp).toLocaleDateString('th-TH')}</div>
                            <div><strong>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠:</strong> ${registration.teacherSignature || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</div>
                        </div>
                    </div>
                `;
            });
            
            statusResult.innerHTML = resultHTML;
        });
    }
    
    // Initialize
    showStudentForm();
    
    // ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏ô‡πâ‡∏≤
    setTimeout(() => {
        testConnection();
    }, 1000);
});

// ======================================
// Registration Submission
// ======================================
async function submitRegistration(data) {
    try {
        console.log('üöÄ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô...');
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
        const registration = {
            id: Date.now().toString(),
            ...data,
            status: 'pending',
            timestamp: new Date().toISOString(),
            statusText: '‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥',
            action: 'submit'
        };

        console.log('Registration data:', registration);

        // ‡πÄ‡∏Å‡πá‡∏ö‡πÉ‡∏ô localStorage
        registrations.push(registration);
        localStorage.setItem('registrations', JSON.stringify(registrations));

        // ‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Apps Script
        const success = await sendToGoogleAppsScript(registration);

        if (success) {
            showNotification('‚úÖ ‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß! ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥', 'success');
            
            // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏ü‡∏≠‡∏£‡πå‡∏°
            document.getElementById('registrationForm').reset();
            const preview = document.getElementById('imagePreview');
            if (preview) preview.innerHTML = '';
            const label = document.querySelector('.file-upload-label');
            if (label) label.textContent = 'üì∑ ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û';
        } else {
            showNotification('‚ö†Ô∏è ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á', 'error');
        }
        
    } catch (error) {
        console.error('Error in submitRegistration:', error);
        showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + error.message, 'error');
    }
}

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Apps Script
async function sendToGoogleAppsScript(data) {
    try {
        console.log('üì° Sending data to Google Apps Script...');
        console.log('URL:', GOOGLE_SHEET_URL);
        
        if (!GOOGLE_SHEET_URL || GOOGLE_SHEET_URL === 'YOUR_GOOGLE_APPS_SCRIPT_URL') {
            throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ GOOGLE_SHEET_URL ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
        }
        
        const response = await fetch(GOOGLE_SHEET_URL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
        });
        
        console.log('Response status:', response.status);
        
        if (response.ok) {
            const result = await response.text();
            console.log('Google Apps Script response:', result);
            
            try {
                const jsonResult = JSON.parse(result);
                if (jsonResult.status === 'success') {
                    console.log('‚úÖ Data sent successfully');
                    return true;
                } else {
                    console.error('‚ùå Server error:', jsonResult.message);
                    showNotification('‚ö†Ô∏è ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å: ' + jsonResult.message, 'error');
                    return false;
                }
            } catch (parseError) {
                console.log('Response is not JSON, but request succeeded');
                return true;
            }
        } else {
            const errorText = await response.text();
            console.error('‚ùå HTTP error:', response.status, errorText);
            throw new Error(`HTTP ${response.status}: ${errorText}`);
        }
        
    } catch (error) {
        console.error('‚ùå Error sending to Google Apps Script:', error);
        showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: ' + error.message, 'error');
        return false;
    }
}

// ======================================
// Admin Functions
// ======================================
function loadRegistrations() {
    const registrationsList = document.getElementById('registrationsList');
    if (!registrationsList) return;
    
    registrationsList.innerHTML = '';

    if (registrations.length === 0) {
        registrationsList.innerHTML = '<p style="text-align: center; color: #666;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô</p>';
        return;
    }

    registrations.forEach(registration => {
        const registrationItem = document.createElement('div');
        registrationItem.className = 'registration-item';
        registrationItem.innerHTML = `
            <h3>${registration.firstName} ${registration.lastName}</h3>
            <div class="registration-details">
                <div><strong>‡∏£‡∏´‡∏±‡∏™:</strong> ${registration.studentId}</div>
                <div><strong>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà:</strong> ${registration.studentNumber}</div>
                <div><strong>‡∏´‡πâ‡∏≠‡∏á:</strong> ${registration.classroom}</div>
                <div><strong>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô:</strong> ${registration.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</div>
                <div><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞:</strong> <span class="status-badge status-${registration.status}">${registration.statusText}</span></div>
                <div><strong>‡∏Ñ‡∏£‡∏π‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠:</strong> ${registration.teacherSignature || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</div>
                <div><strong>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</strong> ${new Date(registration.timestamp).toLocaleDateString('th-TH')}</div>
                ${registration.photo ? `
                <div class="registration-photo">
                    <img src="${registration.photo}" alt="‡∏£‡∏π‡∏õ‡∏ñ‡πà‡∏≤‡∏¢">
                </div>` : ''}
            </div>
            ${registration.status === 'pending' ? `
            <div class="admin-actions">
                <button class="btn-success" onclick="approveRegistration('${registration.id}')">‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
                <button class="btn-danger" onclick="rejectRegistration('${registration.id}')">‚ùå ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥</button>
            </div>` : ''}
        `;
        registrationsList.appendChild(registrationItem);
    });
}

async function approveRegistration(id) {
    const registration = registrations.find(r => r.id === id);
    if (registration) {
        registration.status = 'approved';
        registration.statusText = '‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
        registration.action = 'approved';
        localStorage.setItem('registrations', JSON.stringify(registrations));
        
        // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Apps Script
        await sendToGoogleAppsScript(registration);
        
        loadRegistrations();
        showNotification('‚úÖ ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
    }
}

async function rejectRegistration(id) {
    const registration = registrations.find(r => r.id === id);
    if (registration) {
        registration.status = 'rejected';
        registration.statusText = '‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥';
        registration.action = 'rejected';
        localStorage.setItem('registrations', JSON.stringify(registrations));
        
        // ‡∏™‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏õ‡∏¢‡∏±‡∏á Google Apps Script
        await sendToGoogleAppsScript(registration);
        
        loadRegistrations();
        showNotification('‚úÖ ‡πÑ‡∏°‡πà‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
    }
}

// ======================================
// Utility Functions
// ======================================
function refreshRegistrations() {
    loadRegistrations();
    showNotification('üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
}

function logout() {
    hideAllSections();
    showStudentForm();
    showNotification('üö™ ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', 'success');
}

function showNotification(message, type) {
    let notification = document.getElementById('notification');
    if (!notification) {
        notification = document.createElement('div');
        notification.id = 'notification';
        notification.className = 'notification';
        document.body.appendChild(notification);
    }
    
    notification.textContent = message;
    notification.className = `notification ${type}`;
    notification.classList.add('show');
    
    setTimeout(() => {
        notification.classList.remove('show');
    }, 4000);
}

// ======================================
// Testing Functions
// ======================================
async function testConnection() {
    try {
        console.log('üîç ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Apps Script...');
        console.log('URL:', GOOGLE_SHEET_URL);
        
        if (!GOOGLE_SHEET_URL || GOOGLE_SHEET_URL.includes('YOUR_GOOGLE_APPS_SCRIPT_URL')) {
            console.warn('‚ö†Ô∏è GOOGLE_SHEET_URL ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤');
            return false;
        }
        
        const response = await fetch(GOOGLE_SHEET_URL, {
            method: 'GET'
        });
        
        console.log('Response status:', response.status);
        
        if (response.ok) {
            const result = await response.text();
            console.log('Response:', result);
            
            try {
                const jsonResult = JSON.parse(result);
                if (jsonResult.status === 'ok') {
                    console.log('‚úÖ Connection test successful');
                    showNotification('‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Google Apps Script ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!', 'success');
                    return true;
                } else {
                    console.warn('‚ö†Ô∏è Unexpected response:', jsonResult);
                    showNotification('‚ö†Ô∏è Google Apps Script ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥', 'error');
                    return false;
                }
            } catch (parseError) {
                console.log('Response is not JSON');
                showNotification('‚ö†Ô∏è Google Apps Script ‡∏ï‡∏≠‡∏ö‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON', 'error');
                return false;
            }
        } else {
            console.error('‚ùå Connection failed:', response.status);
            showNotification(`‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: HTTP ${response.status}`, 'error');
            return false;
        }
        
    } catch (error) {
        console.error('‚ùå Connection error:', error);
        console.warn('Connection test failed - may need to set GOOGLE_SHEET_URL');
        return false;
    }
}

async function sendTestData() {
    try {
        console.log('üìä ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
        
        if (!GOOGLE_SHEET_URL || GOOGLE_SHEET_URL.includes('YOUR_GOOGLE_APPS_SCRIPT_URL')) {
            showNotification('‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ GOOGLE_SHEET_URL ‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏î‡∏™‡∏≠‡∏ö', 'error');
            return;
        }
        
        const testData = {
            id: 'TEST_' + Date.now(),
            studentId: 'TEST001',
            studentNumber: '99',
            firstName: '‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
            lastName: '‡∏£‡∏∞‡∏ö‡∏ö',
            classroom: '‡∏°.1/1',
            points: '1',
            teacherSignature: '‡∏Ñ‡∏£‡∏π‡∏ó‡∏î‡∏™‡∏≠‡∏ö',
            photo: null,
            action: 'submit',
            timestamp: new Date().toISOString()
        };
        
        console.log('Test data:', testData);
        
        const success = await sendToGoogleAppsScript(testData);
        
        if (success) {
            showNotification('‚úÖ ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö Google Sheets', 'success');
        } else {
            showNotification('‚ùå ‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
        }
        
    } catch (error) {
        console.error('‚ùå Test error:', error);
        showNotification('‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö: ' + error.message, 'error');
    }
}

function showDebugInfo() {
    console.log('=== DEBUG INFO ===');
    console.log('GOOGLE_SHEET_URL:', GOOGLE_SHEET_URL);
    console.log('Registrations count:', registrations.length);
    console.log('Current time:', new Date().toISOString());
    console.log('User agent:', navigator.userAgent);
    console.log('Current location:', window.location.href);
    
    const urlValid = GOOGLE_SHEET_URL && !GOOGLE_SHEET_URL.includes('YOUR_GOOGLE_APPS_SCRIPT_URL');
    
    const info = `
üìã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£ Debug:

üîó Google Apps Script URL: 
${GOOGLE_SHEET_URL}

‚úÖ URL ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á: ${urlValid ? '‡πÉ‡∏ä‡πà' : '‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà'}

üìä ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô localStorage: ${registrations.length}

üïê ‡πÄ‡∏ß‡∏•‡∏≤‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${new Date().toLocaleString('th-TH')}

üåê ‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå: ${navigator.userAgent.includes('Chrome') ? 'Chrome' : navigator.userAgent.includes('Firefox') ? 'Firefox' : '‡∏≠‡∏∑‡πà‡∏ô‡πÜ'}

üìç URL ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: ${window.location.href}

${!urlValid ? '\n‚ö†Ô∏è ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï GOOGLE_SHEET_URL ‡πÉ‡∏´‡πâ‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á' : ''}

‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°‡πÉ‡∏ô Console (‡∏Å‡∏î F12)
    `;
    
    alert(info);
}
